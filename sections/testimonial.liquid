{% comment %} Content settings {% endcomment %}
{%- assign title = section.settings.title | escape -%}
{%- assign transparency = section.settings.transparency -%}
{%- assign blocks = section.blocks -%}
{% comment %} End content settings {% endcomment %}

<div class="testimonial-container" data-section-id="{{ section.id }}">
  {% if title != blank %}
      <h2 class="title center">{{ title }}</h2>
  {% endif %}
  {% if blocks.size > 0 %}
    <section id="slideshow-{{ section.id }}" class="testimonial-bar center {% if transparency != blank %}set-transparency{% endif %}">
      <div class="slideshow slideshow_animation--slide"
          data-slider-id="slideshow-{{ section.id }}"
          data-slideshow-speed="{{ section.settings.slideshow_speed }}">
        {% for block in blocks %}

          {% comment %} Content settings {% endcomment %}
          {%- assign testimonial = block.settings.testimonial -%}
          {% comment %} End content settings {% endcomment %}

          <div class="slideshow__gallery-cell slideshow__gallery-cell-slide-{{ forloop.index }}
              quotes-slide--{{ block.id }}" {{ block.shopify_attributes }}
              data-block-id="{{block.id}}">
            <div class="testimonial-block">
              {{ testimonial }}
              {% if block.settings.name != blank %}
                <p>
                  <span class="name">{{ block.settings.name }}</span><br>

                  {% if block.settings.site_link != blank %}
                    <a href="{{ block.settings.site_link }}">
                  {% endif %}

                  {% if block.settings.site != blank %}
                    {{ block.settings.site }}
                  {% endif %}

                  {% if block.settings.site_link != blank %}
                    </a>
                  {% endif %}
                </p>
              {% else %}
                <p>
                {% if block.settings.site_link != blank %}
                  <a href="{{ block.settings.site_link }}">
                {% endif %}

                {% if block.settings.site != blank %}
                  {{ block.settings.site }}
                {% endif %}

                {% if block.settings.site_link != blank %}
                  </a>
                {% endif %}
              </p>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </section>
  {% endif %}
</div>

{% schema %}
  {
    "name": "Testimonials",
    "class": "testimonial-section",
    "max_blocks": 12,
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "Testimonials"
      },
      {
        "type": "checkbox",
        "id": "transparency",
        "label": "Enable transparency",
        "default": false
      }
    ],
    "blocks": [
      {
        "type": "quote",
        "name": "Testimonial",
        "settings": [
          {
            "type": "richtext",
            "id": "testimonial",
            "label": "Testimonial",
            "default": "<p>Include some of your favorite customer quotes and feedback here as social proof, to build credibility and trust for your services and products.</p>"
          },
          {
            "type": "text",
            "id": "name",
            "label": "Customer name",
            "info": "Optional",
            "default": "John Doe"
          },
          {
            "type": "text",
            "id": "site",
            "label": "Customer link",
            "info": "Optional",
            "default": "www.example.com"
          },
          {
            "type": "url",
            "id": "site_link",
            "label": "Customer link URL",
            "info": "Optional"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Testimonials",
        "category": "Text",
        "blocks": [
          {
            "type": "quote"
          }
        ]
      }
    ]
  }
{% endschema %}
